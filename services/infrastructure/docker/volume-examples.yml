# Docker Volume íŠ¹ë³„ ìš”êµ¬ì‚¬í•­ ì˜ˆì‹œë“¤
version: '3.8'

volumes:
  # ğŸ”¥ 1. ì„±ëŠ¥ ìµœì í™” - SSD ê²½ë¡œ ì§€ì •
  high_performance_db:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /mnt/nvme-ssd/mysql-data  # ê³ ì„±ëŠ¥ SSD ë””ìŠ¤í¬ ì‚¬ìš©

  # ğŸŒ 2. NFS ë„¤íŠ¸ì›Œí¬ ìŠ¤í† ë¦¬ì§€ (í´ëŸ¬ìŠ¤í„° í™˜ê²½)
  shared_data:
    driver: local
    driver_opts:
      type: nfs
      o: addr=192.168.1.100,rw,noatime,rsize=8192,wsize=8192
      device: ":/mnt/shared/mysql"

  # ğŸ§  3. ë©”ëª¨ë¦¬ ê¸°ë°˜ ì„ì‹œ ë°ì´í„° (Redis ê°™ì€ ìºì‹œ)
  memory_cache:
    driver: local
    driver_opts:
      type: tmpfs
      device: tmpfs
      o: size=1g,uid=999,gid=999  # 1GB ë©”ëª¨ë¦¬, MySQL ì‚¬ìš©ì ê¶Œí•œ

  # ğŸ”’ 4. ì•”í˜¸í™”ëœ ë³¼ë¥¨ (ë¯¼ê°í•œ ë°ì´í„°)
  encrypted_data:
    driver: local
    driver_opts:
      type: none
      o: bind,encryption=aes256
      device: /encrypted/mysql-data

  # ğŸ“Š 5. ë°±ì—… ì „ìš© ë³¼ë¥¨ (ì½ê¸° ì „ìš©)
  backup_storage:
    driver: local
    driver_opts:
      type: none
      o: bind,ro  # ì½ê¸° ì „ìš©
      device: /backup/mysql

  # â˜ï¸ 6. AWS EFS (í´ë¼ìš°ë“œ íŒŒì¼ì‹œìŠ¤í…œ)
  aws_efs:
    driver: local
    driver_opts:
      type: nfs4
      o: addr=fs-12345.efs.us-west-2.amazonaws.com,rsize=1048576,wsize=1048576
      device: :/

  # ğŸš€ 7. ê³ ê°€ìš©ì„± Ceph ìŠ¤í† ë¦¬ì§€
  ceph_storage:
    driver: local
    driver_opts:
      type: ceph
      o: name=admin,secret=AQD...==
      device: 192.168.1.10:6789,192.168.1.11:6789:/mysql

  # ğŸ“ˆ 8. ëª¨ë‹ˆí„°ë§ì´ ê°€ëŠ¥í•œ ë³¼ë¥¨
  monitored_volume:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /data/mysql
    labels:
      - "monitoring=enabled"
      - "backup=daily"
      - "tier=production"

# ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ
services:
  # ê³ ì„±ëŠ¥ì´ í•„ìš”í•œ í”„ë¡œë•ì…˜ DB
  production_mysql:
    image: mysql:8.0
    volumes:
      - high_performance_db:/var/lib/mysql
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}

  # ê°œë°œìš© ë©”ëª¨ë¦¬ ìºì‹œ
  dev_redis:
    image: redis:alpine
    volumes:
      - memory_cache:/data

  # ë°±ì—… ì „ìš© ì»¨í…Œì´ë„ˆ
  backup_service:
    image: mysql:8.0
    volumes:
      - backup_storage:/backup:ro  # ì½ê¸° ì „ìš©ìœ¼ë¡œ ë§ˆìš´íŠ¸
    command: mysqldump --all-databases
